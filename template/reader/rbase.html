{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="{% static 'css/output.css' %}" rel="stylesheet" />
    <style>
      /* This is a temporary style for the main content area to make clicks outside the nav detectable.
                                                                                                                                                                                 You should ensure your main content block properly fills the screen below the nav. */
      .main-content-overlay {
        min-height: calc(100vh - 14rem); /* Adjust based on your footer height and nav height */
        width: 100%;
        position: relative;
        z-index: 30; /* Ensure it's below the nav but above other background elements for click detection */
      }
      /* Custom utility for no-scrollbar - ensuring it's in base for horizontal scrolls */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
    </style>
  </head>

  <body class="h-auto bg-orange-50 font-sans m-0 p-0 text-amber-950">
    {# Added text-amber-950 as default text color #}
    <!-- Navbar -->
    <nav class="sticky top-0 w-full bg-orange-100 h-14 text-amber-950 flex items-center justify-between px-4 md:px-10 shadow-lg z-40">
      {# Changed shadow-md to shadow-lg #}
      <a href="{% url 'home' %}" class="inline-block transform transition-transform duration-200 hover:scale-105"><img src="{% static 'images/Brown_Full_logo.png' %}" alt="Signed & Stamped Logo" class="h-full max-h-12 md:max-h-12 object-contain block" /></a> {# Added hover effect #}

      <!-- Desktop Menu -->
      <ul class="hidden md:flex md:flex-row flex-col items-center space-x-5">
        <li>
          <a href="{% url 'home' %}" class="hover:text-orange-500 font-medium transition-colors duration-200">Home</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'browse' %}" class="hover:text-orange-500 font-medium transition-colors duration-200">Browse</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'contest' %}" class="hover:text-orange-500 font-medium transition-colors duration-200">Contest</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'about' %}" class="hover:text-orange-500 font-medium transition-colors duration-200">About</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'create' %}" class="hover:text-orange-500 font-medium transition-colors duration-200">Create</a> {# Added font-medium and transition #}
        </li>
        <li>
          <form method="GET" action="{% url 'browse' %}" class="w-full md:w-64">
            <div class="relative w-full">
              <input type="text" name="q" placeholder="Search books" class="w-full pl-10 pr-3 py-2 rounded-full border border-gray-300 bg-white text-amber-950 placeholder-amber-400 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-all duration-200" value="{{ request.GET.q|default:'' }}" /> {# Added duration #}
              <!-- Magnifying glass icon inside input -->
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">üîç</span>
            </div>
          </form>
        </li>

        <li>
          <a href="{% url 'library' %}"><button class="text-2xl hover:scale-110 transition-transform duration-200 transform">‚ù§Ô∏è</button></a> {# Changed emoji, added duration and transform #}
        </li>
        <li>
          {% if user.is_authenticated %}
            <!-- User PFP button -->
            <button id="user-pfp-btn" class="focus:outline-none transform transition-all duration-200 hover:scale-110 hover:shadow-lg rounded-full border-2 border-amber-900 object-cover"><img src="{{ user.profile_picture.url }}" alt="Profile" class="w-9 h-9 rounded-full object-cover" /></button>
          {% else %}
            <button id="dsignin" class="p-2 h-9 text-white bg-amber-900 rounded-3xl text-sm font-bold hover:bg-amber-800 transition-all duration-200 hover:shadow-md transform hover:scale-105">SIGN IN</button> {# Added duration, shadow, transform, scale #}
          {% endif %}
        </li>
      </ul>

      <!-- Mobile Menu Button -->
      <div id="menu" class="text-3xl md:hidden cursor-pointer transform transition-transform duration-200 hover:scale-110">‚ò∞</div> {# Added hover effect #}
    </nav>

    <!-- Mobile Sidebar -->
    <div id="mobile-menu" class="fixed top-14 left-0 h-screen w-52 bg-orange-100 text-amber-950 shadow-xl transform -translate-x-full transition-transform duration-300 md:hidden z-50 flex flex-col rounded-r-lg">
      {# Changed shadow-lg to shadow-xl, added rounded-r-lg #}
      <!-- User Profile -->
      {% if user.is_authenticated %}
        <div class="flex flex-col items-center p-4 border-b border-amber-900/50">
          {# Added /50 for subtle border #}
          <img src="{{ user.profile_picture.url }}" alt="Profile Picture" class="w-16 h-16 rounded-full border-2 border-amber-900 object-cover shadow-sm" /> {# Added shadow-sm #}

          <div class="mt-2 flex items-center space-x-1">
            <p class="font-semibold truncate">{{ user.username }}</p>
            <!-- Edit PFP Button -->
            <a href="{% url 'updateprofile' %}" id="edit-pfp-btn" class="text-amber-800 hover:text-orange-500 transition-colors duration-200 transform hover:scale-110">‚úèÔ∏è</a> {# Added transition, scale #}
          </div>
        </div>
      {% endif %}

      <!-- Search & Menu Links -->
      <ul class="flex flex-col space-y-2 mt-4 px-4">
        <li class="w-full px-4 my-2">
          <form method="GET" action="{% url 'browse' %}" class="w-full">
            <div class="relative w-full">
              <input type="text" name="q" placeholder="Search books" class="w-full pl-10 pr-3 py-2 rounded-full border border-gray-300 bg-white text-amber-950 placeholder-amber-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-all duration-200" value="{{ request.GET.q|default:'' }}" /> {# Added duration #}
              <!-- Magnifying glass icon inside input -->
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">üîç</span>
            </div>
          </form>
        </li>
        <li>
          <a href="{% url 'browse' %}" class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Browse</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'contest' %}" class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Contest</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'about' %}" class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">About</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'create' %}" class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Create</a> {# Added font-medium and transition #}
        </li>
        <li>
          <a href="{% url 'library' %}" class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Library</a> {# Added font-medium and transition #}
        </li>
        <br /><br />

        <!-- Logout / Sign-in -->
        <li>
          {% if user.is_authenticated %}
            <form action="{% url 'logout' %}" method="POST">
              {% csrf_token %}
              <button id="mlogout" class="block text-center p-1 h-8 w-24 text-white bg-amber-900 rounded-3xl hover:bg-amber-800 text-sm font-bold mx-auto transition-all duration-200 hover:shadow-md transform hover:scale-105">LOGOUT</button> {# Added duration, shadow, transform, scale #}
            </form>
          {% else %}
            <button id="msignin" class="block text-center p-1 h-8 w-24 text-white bg-amber-900 rounded-3xl hover:bg-amber-800 text-sm font-bold mx-auto transition-all duration-200 hover:shadow-md transform hover:scale-105">SIGN IN</button> {# Added duration, shadow, transform, scale #}
          {% endif %}
        </li>
      </ul>
    </div>

    {% if messages %}
      <div id="toast-container" class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 p-2">
        {# Added p-2 for padding #}
        {% for message in messages %}
          <div class="px-4 py-3 rounded-lg shadow-xl text-sm font-medium
        {% if message.tags == 'error' %}
              
              bg-red-600 text-white

            {% elif message.tags == 'success' %}
              
              bg-green-600 text-white

            {% else %}
              
              bg-gray-800 text-white

            {% endif %}
        transition transform opacity-100 duration-500 scale-100 ease-out">
            {# Added scale-100 ease-out for smoother entry #}
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Main content -->
    <div class="main-content-overlay" id="main-content">
      {% block body %}

      {% endblock %}
    </div>

    <!-- Footer -->
    <footer class="bg-amber-950 text-white px-4 py-8 md:px-8 md:py-12 mt-10 shadow-inner">
      {# Increased padding, added shadow-inner #}
      <div class="flex flex-col md:flex-row justify-between items-start gap-6 md:gap-10 max-w-7xl mx-auto">
        {# Increased gap, added max-width and auto margins #}
        <!-- Logo -->
        <div class="flex items-center gap-2 md:gap-3 flex-shrink-0 transform transition-transform duration-200 hover:scale-105">
          {# Added hover effect #}
          <img src="{% static 'images/Kariya-removebg-preview.png' %}" alt="Signed & Stamped Footer Logo" class="w-12 md:w-16 h-auto object-contain" />
          <h1 class="text-lg md:text-2xl font-extrabold whitespace-nowrap">Signed & Stamped</h1>
        </div>

        <!-- Contact Info -->
        <div class="flex flex-col gap-2 md:gap-3 text-sm md:text-base">
          {# Increased gap #}
          <h2 class="font-bold text-lg mb-1">Contact</h2> {# Added heading #}
          <a href="#" class="hover:text-orange-300 transition-colors duration-200">Email: contact@example.com</a> {# Added actual content and transition #}
          <a href="#" class="hover:text-orange-300 transition-colors duration-200">Phone: +1 (555) 123-4567</a> {# Added actual content and transition #}
        </div>

        <!-- Desktop-only -->
        <div class="hidden md:flex flex-col gap-2 text-sm md:text-base">
          {# Increased gap #}
          <h2 class="font-bold text-lg mb-1">Our Team</h2> {# Changed h1 to h2, added font-bold, mb-1 #}
          <a href="#" class="font-normal hover:text-orange-300 transition-colors duration-200">Member 1 Name</a> {# Added transition #}
          <a href="#" class="font-normal hover:text-orange-300 transition-colors duration-200">Member 2 Name</a> {# Added transition #}
        </div>

        <div class="hidden md:flex flex-col gap-2 text-sm md:text-base">
          {# Increased gap #}
          <h2 class="font-bold text-lg mb-1">Legal</h2> {# Changed h1 to h2, added font-bold, mb-1 #}
          <a href="#" class="font-normal hover:text-orange-300 transition-colors duration-200">Terms of Service</a> {# Changed content, added transition #}
          <a href="#" class="font-normal hover:text-orange-300 transition-colors duration-200">Privacy Policy</a> {# Changed content, added transition #}
        </div>

        <div class="hidden md:flex gap-4 text-lg md:text-xl self-end">
          {# Increased gap, added self-end #}
          <a href="#" class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üìò</a> {# Added transition, scale #}
          <a href="#" class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üê¶</a> {# Added transition, scale #}
          <a href="#" class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üì∏</a> {# Added transition, scale #}
        </div>
      </div>
      <div class="mt-8 text-center text-gray-400 text-sm border-t border-amber-800/50 pt-6">&copy; 2024 Signed & Stamped. All rights reserved.</div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="fixed bottom-6 right-6 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 hidden z-50 transform hover:scale-105">‚Üë Top</button> {# Added duration, transform, scale #}

    <!-- User Sidebar -->
    <div id="user-sidebar" class="fixed top-0 right-0 h-screen w-80 bg-orange-100 shadow-xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col rounded-l-lg">
      {# Changed shadow-lg to shadow-xl, added rounded-l-lg #}
      <!-- Header / Edit PFP -->
      <div class="flex flex-col items-center p-4 border-b border-amber-900/50">
        {# Added /50 for subtle border #}
        <img id="sidebar-pfp" src="{{ user.profile_picture.url }}" alt="Profile Picture" class="w-20 h-20 rounded-full border-2 border-amber-900 object-cover shadow-md" /> {# Added shadow-md #}
        <a href="{% url 'updateprofile' %}" id="edit-pfp-btn" class="mt-3 px-5 py-1.5 bg-amber-900 text-white rounded-xl text-sm hover:bg-amber-800 transition-colors duration-200 inline-block text-center font-medium shadow-sm transform hover:scale-105">Edit Profile</a> {# Adjusted padding, text, added duration, shadow, scale #}
      </div>

      <!-- User Info -->
      <div class="flex flex-col p-4 space-y-3 flex-grow text-base">
        {# Increased space-y, added flex-grow, text-base #}
        <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
          {# Added border #}
          <strong class="font-semibold text-amber-900">Username:</strong> <span class="text-gray-700">{{ user.username }}</span>
        </div>
        <div class="flex justify-between items-start pb-2 border-b border-amber-900/10">
          {# Added border #}
          <strong class="font-semibold text-amber-900">Bio:</strong> <span class="text-gray-700 text-right">{{ user.bio|default:'Not set' }}</span>
        </div>
        <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
          {# Added border #}
          <strong class="font-semibold text-amber-900">Gender:</strong> <span class="text-gray-700">{{ user.gender|default:'Not set' }}</span>
        </div>
        <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
          {# Added border #}
          <strong class="font-semibold text-amber-900">Country:</strong> <span class="text-gray-700">{{ user.country|default:'Not set' }}</span>
        </div>
        {# Add more profile info here if needed #}
      </div>

      <div class="mt-auto p-4 border-t border-amber-900/50">
        {# Added border-t #}
        <!-- Logout Button -->
        <form action="{% url 'logout' %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="w-full px-4 py-2.5 text-white bg-amber-900 rounded-xl hover:bg-amber-800 transition-colors duration-200 font-bold shadow-md transform hover:scale-105">Logout</button> {# Adjusted padding, added duration, shadow, scale #}
        </form>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const pfpBtn = document.getElementById('user-pfp-btn')
        const sidebar = document.getElementById('user-sidebar')
        const menuButton = document.getElementById('menu')
        const mobileMenu = document.getElementById('mobile-menu')
        const backToTop = document.getElementById('backToTop')
        const dsignInButton = document.getElementById('dsignin')
        const msignInButton = document.getElementById('msignin')
      
        // --- User PFP Sidebar Toggle ---
        pfpBtn?.addEventListener('click', (event) => {
          sidebar.classList.toggle('translate-x-full')
          event.stopPropagation() // Prevent immediate close
        })
        sidebar?.addEventListener('click', (event) => event.stopPropagation())
      
        // --- Mobile Menu Toggle ---
        menuButton?.addEventListener('click', (event) => {
          event.stopPropagation()
          mobileMenu?.classList.toggle('-translate-x-full')
        })
        mobileMenu?.addEventListener('click', (event) => event.stopPropagation())
      
        // --- Close menus if clicking outside ---
        document.body.addEventListener('click', (event) => {
          // Close mobile menu
          if (mobileMenu && menuButton && !mobileMenu.contains(event.target) && !menuButton.contains(event.target) && !mobileMenu.classList.contains('-translate-x-full')) {
            mobileMenu.classList.add('-translate-x-full')
          }
      
          // Close user sidebar
          if (sidebar && !sidebar.contains(event.target) && (!pfpBtn || !pfpBtn.contains(event.target)) && !sidebar.classList.contains('translate-x-full')) {
            sidebar.classList.add('translate-x-full')
          }
        })
      
        // Swipe gesture for mobile menu
        let touchStartX = 0
        mobileMenu?.addEventListener('touchstart', (event) => (touchStartX = event.touches[0].clientX))
        mobileMenu?.addEventListener('touchmove', (event) => {
          if (!mobileMenu.classList.contains('-translate-x-full')) {
            const touchMoveX = event.touches[0].clientX
            if (touchStartX - touchMoveX > 50) mobileMenu.classList.add('-translate-x-full')
          }
        })
      
        // --- Sign In Button Redirect ---
        dsignInButton?.addEventListener('click', () => (window.location.href = "{% url 'login' %}"))
        msignInButton?.addEventListener('click', () => (window.location.href = "{% url 'login' %}"))
      
        // --- Back to top button ---
        window.addEventListener('scroll', () => {
          backToTop?.classList[window.scrollY > 200 ? 'remove' : 'add']('hidden')
        })
        backToTop?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }))
      
        // --- Toast auto hide ---
        setTimeout(() => {
          const toast = document.getElementById('toast-container')
          if (toast) {
            toast.classList.add('opacity-0', 'translate-y-5', 'scale-95') // Added translate-y and scale for exit animation
            setTimeout(() => toast.remove(), 500)
          }
        }, 3000)
      })
    </script>
  </body>
</html>
