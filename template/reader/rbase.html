{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="theme-color" content="#92400e">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            {% block title %}Signed Publishing | Where Authors and Readers Connect{% endblock %}
        </title>
        {% block meta %}
            <meta name="description"
                  content="{% block meta_description %}Signed Publishing is the creative hub for authors and readers. Explore books, contests, and our weekly magazine featuring new stories and talents.{% endblock %}">
            <meta name="keywords"
                  content="{% block meta_keywords %}Signed Publishing, publishing, books, authors, writers, contests, novels, magazine, creative community, stories, enovel, webnovel, ebook, fanfiction{% endblock %}">
            <meta name="author" content="Signed Publishing Team">
            <meta name="robots" content="index, follow">
            <meta name="language" content="English">
            <!-- üü¶ Open Graph (Facebook / LinkedIn) -->
            <meta property="og:title"
                  content="{% block og_title %}Signed Publishing | Where Authors and Readers Connect{% endblock %}">
            <meta property="og:description"
                  content="{% block og_description %}Explore books, contests, and our weekly magazine. Join a creative hub for authors and readers.{% endblock %}">
            <meta property="og:url"
                  content="{% block og_url %}https://www.signedpublishing.com{% endblock %}">
            <meta property="og:image"
                  content="{% block og_image %}{% static 'images/Brown_Full_logo.png' %}{% endblock %}">
            <meta property="og:type" content="website">
            <meta property="og:site_name" content="Signed Publishing">
            <!-- üê¶ Twitter Card -->
            <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:title"
                  content="{% block twitter_title %}Signed Publishing | Where Authors and Readers Connect{% endblock %}">
            <meta name="twitter:description"
                  content="{% block twitter_description %}Explore books, contests, and our weekly magazine. Join a creative hub for authors and readers.{% endblock %}">
            <meta name="twitter:image"
                  content="{% block twitter_image %}{% static 'images/Brown_Full_logo.png' %}{% endblock %}">
        {% endblock %}
        <link rel="icon"
              type="image/png"
              href="{% static 'images/Kariya-removebg-preview.png' %}">
        <link href="{% static 'css/output.css' %}" rel="stylesheet" />
        <style>
    /* This is a temporary style for the main content area to make clicks outside the nav detectable.
                                                                                                                                                                                 You should ensure your main content block properly fills the screen below the nav. */
    .main-content-overlay {
      min-height: calc(100vh - 14rem);
      /* Adjust based on your footer height and nav height */
      width: 100%;
      position: relative;
      z-index: 30;
      /* Ensure it's below the nav but above other background elements for click detection */
    }

    /* Custom utility for no-scrollbar - ensuring it's in base for horizontal scrolls */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }
        </style>
    </head>
    <body class="h-auto bg-orange-50 font-sans m-0 p-0 text-amber-950">
        <!-- Navbar -->
        <nav class="sticky top-0 w-full bg-orange-100 h-14 text-amber-950 flex items-center justify-between px-4 md:px-10 shadow-lg z-40">
            <a href="{% url 'home' %}"
               class="inline-block transform transition-transform duration-200 hover:scale-105">
                <img src="{% static 'images/Brown_Full_logo.png' %}"
                     alt="Signed & Stamped Logo"
                     class="h-full max-h-12 md:max-h-12 object-contain block" />
            </a>
            <!-- Desktop Menu -->
            <ul class="hidden md:flex md:flex-row flex-col items-center space-x-5">
                <li>
                    <a href="{% url 'browse' %}"
                       class="hover:text-orange-500 font-medium transition-colors duration-200">Browse</a>
                </li>
                <li>
                    <a href="{% url 'contest' %}"
                       class="hover:text-orange-500 font-medium transition-colors duration-200">Contest</a>
                </li>
                <li>
                    <a href="{% url 'about' %}"
                       class="hover:text-orange-500 font-medium transition-colors duration-200">About</a>
                </li>
                <li>
                    <a href="{% url 'create' %}"
                       class="hover:text-orange-500 font-medium transition-colors duration-200">Create</a>
                </li>
                <li>
                    <form method="GET" action="{% url 'browse' %}" class="w-full md:w-64">
                        <div class="relative w-full">
                            <input type="text"
                                   name="q"
                                   placeholder="Search books"
                                   class="w-full pl-10 pr-3 py-2 rounded-full border border-gray-300 bg-white text-amber-950 placeholder-amber-900 shadow-md focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-all duration-200"
                                   value="{{ request.GET.q|default:'' }}" />
                            <!-- Magnifying glass icon inside input -->
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-amber-950 pointer-events-none">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 24 24"
                                     fill="currentColor"
                                     class="w-5 h-5">
                                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79 l5 4.99L20.49 19l-4.99-5zm-6 0 C8.01 14 6 11.99 6 9.5S8.01 5 10.5 5 15 7.01 15 9.5 12.99 14 10.5 14z" />
                                </svg>
                            </span>
                        </div>
                    </form>
                </li>
                <li>
                    <a href="{% url 'library' %}">
                        <button class="hover:scale-110 transition-transform duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 24 24"
                                 fill="currentColor"
                                 class="w-7 h-7 text-amber-950">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09 C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5 c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                        </button>
                    </a>
                </li>
                <li>
                    {% if user.is_authenticated %}
                        <!-- User PFP button -->
                        <button id="user-pfp-btn"
                                class="focus:outline-none transform transition-all duration-200 hover:scale-110 hover:shadow-lg rounded-full border-2 border-amber-900 object-cover">
                            <img src="{{ user.profile_picture.url }}"
                                 alt="Profile"
                                 class="w-9 h-9 rounded-full object-cover" />
                        </button>
                    {% else %}
                        <button id="dsignin"
                                class="p-2 h-9 text-white bg-amber-900 rounded-3xl text-sm font-bold hover:bg-amber-800 transition-all duration-200 hover:shadow-md transform hover:scale-105">
                            SIGN
                            IN
                        </button>
                    {% endif %}
                </li>
            </ul>
            <!-- Mobile Menu Button -->
            <div id="menu"
                 class="text-3xl md:hidden cursor-pointer transform transition-transform duration-200 hover:scale-110">
                ‚ò∞
            </div>
        </nav>
        <!-- Mobile Sidebar -->
        <div id="mobile-menu"
             class="fixed top-14 left-0 h-screen w-52 bg-orange-100 text-amber-950 shadow-xl transform -translate-x-full transition-transform duration-300 md:hidden z-50 flex flex-col rounded-r-lg">
            <!-- User Profile -->
            {% if user.is_authenticated %}
                <div class="flex flex-col items-center p-4 border-b border-amber-900/50">
                    <img src="{{ user.profile_picture.url }}"
                         alt="Profile Picture"
                         class="w-16 h-16 rounded-full border-2 border-amber-900 object-cover shadow-sm" />
                    <div class="mt-2 flex items-center space-x-1">
                        <p class="font-semibold truncate">{{ user.username }}</p>
                        <!-- Edit PFP Button -->
                        <a href="{% url 'updateprofile' %}"
                           id="edit-pfp-btn"
                           class="text-amber-800 hover:text-orange-500 transition-colors duration-200 transform hover:scale-110">‚úèÔ∏è</a>
                    </div>
                </div>
            {% endif %}
            <!-- Search & Menu Links -->
            <ul class="flex flex-col space-y-2 mt-4 px-4">
                <li class="w-full px-4 my-2">
                    <form method="GET" action="{% url 'browse' %}" class="w-full">
                        <div class="relative w-full">
                            <input type="text"
                                   name="q"
                                   placeholder="Search books"
                                   class="w-full pl-10 pr-3 py-2 rounded-full border border-gray-300 bg-white text-amber-950 placeholder-amber-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition-all duration-200"
                                   value="{{ request.GET.q|default:'' }}" />
                            <!-- Magnifying glass icon inside input -->
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">üîç</span>
                        </div>
                    </form>
                </li>
                <li>
                    <a href="{% url 'browse' %}"
                       class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Browse</a>
                </li>
                <li>
                    <a href="{% url 'contest' %}"
                       class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Contest</a>
                </li>
                <li>
                    <a href="{% url 'about' %}"
                       class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">About</a>
                </li>
                <li>
                    <a href="{% url 'create' %}"
                       class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Create</a>
                </li>
                <li>
                    <a href="{% url 'library' %}"
                       class="block hover:bg-orange-200 px-3 py-2 rounded font-medium transition-colors duration-200">Library</a>
                </li>
                <br />
                <br />
                <!-- Logout / Sign-in -->
                <li>
                    {% if user.is_authenticated %}
                        <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button id="mlogout"
                                    class="block text-center p-1 h-8 w-24 text-white bg-amber-900 rounded-3xl hover:bg-amber-800 text-sm font-bold mx-auto transition-all duration-200 hover:shadow-md transform hover:scale-105">
                                LOGOUT
                            </button>
                        </form>
                    {% else %}
                        <button id="msignin"
                                class="block text-center p-1 h-8 w-24 text-white bg-amber-900 rounded-3xl hover:bg-amber-800 text-sm font-bold mx-auto transition-all duration-200 hover:shadow-md transform hover:scale-105">
                            SIGN
                            IN
                        </button>
                    {% endif %}
                </li>
            </ul>
        </div>
        {% if messages %}
            <div id="toast-container"
                 class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 p-2">
                {% for message in messages %}
                    <div class="px-4 py-3 rounded-lg shadow-xl text-sm font-medium {% if message.tags == 'error' %}  bg-red-600 text-white  {% elif message.tags == 'success' %}  bg-green-600 text-white  {% else %}  bg-gray-800 text-white  {% endif %} transition transform opacity-100 duration-500 scale-100 ease-out">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <!-- Main content -->
        <div class="main-content-overlay" id="main-content">
            {% block body %}{% endblock %}
        </div>
        <!-- Footer -->
        <footer class="bg-amber-950 text-white px-4 py-8 md:px-8 md:py-12 mt-10 shadow-inner">
            <div class="flex flex-col md:flex-row justify-between items-start gap-6 md:gap-10 max-w-7xl mx-auto">
                <!-- Logo -->
                <div class="flex items-center gap-2 md:gap-3 flex-shrink-0 transform transition-transform duration-200 hover:scale-105">
                    <img src="{% static 'images/Kariya-removebg-preview.png' %}"
                         alt="Signed & Stamped Footer Logo"
                         class="w-12 md:w-16 h-auto object-contain" />
                    <h1 class="text-lg md:text-2xl font-extrabold whitespace-nowrap">Signed & Stamped</h1>
                </div>
                <!-- Contact Info -->
                <div class="flex flex-col gap-2 md:gap-3 text-sm md:text-base">
                    <h2 class="font-bold text-lg mb-1">Contact</h2>
                    <a href="#" class="hover:text-orange-300 transition-colors duration-200">Email: contact@example.com</a>
                    <a href="#" class="hover:text-orange-300 transition-colors duration-200">Phone: +1 (555) 123-4567</a>
                </div>
                <!-- Desktop-only -->
                <div class="hidden md:flex flex-col gap-2 text-sm md:text-base">
                    <h2 class="font-bold text-lg mb-1">Our Team</h2>
                    <a href="#"
                       class="font-normal hover:text-orange-300 transition-colors duration-200">Member 1 Name</a>
                    <a href="#"
                       class="font-normal hover:text-orange-300 transition-colors duration-200">Member 2 Name</a>
                </div>
                <div class="hidden md:flex flex-col gap-2 text-sm md:text-base">
                    <h2 class="font-bold text-lg mb-1">Legal</h2>
                    <a href="#"
                       class="font-normal hover:text-orange-300 transition-colors duration-200">Terms of Service</a>
                    <a href="#"
                       class="font-normal hover:text-orange-300 transition-colors duration-200">Privacy Policy</a>
                </div>
                <div class="hidden md:flex gap-4 text-lg md:text-xl self-end">
                    <a href="#"
                       class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üìò</a>
                    <a href="#"
                       class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üê¶</a>
                    <a href="#"
                       class="hover:text-orange-300 transition-colors duration-200 transform hover:scale-110">üì∏</a>
                </div>
            </div>
            <div class="mt-8 text-center text-gray-400 text-sm border-t border-amber-800/50 pt-6">
                &copy; 2024 Signed & Stamped.
                All rights reserved.
            </div>
        </footer>
        <!-- Back to Top Button -->
        <button id="backToTop"
                class="fixed bottom-6 right-6 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 hidden z-50 transform hover:scale-105">
            ‚Üë
            Top
        </button>
        <!-- User Sidebar -->
        <div id="user-sidebar"
             class="fixed top-0 right-0 h-screen w-80 bg-orange-100 shadow-xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col rounded-l-lg">
            <!-- Header / Edit PFP -->
            <div class="flex flex-col items-center p-4 border-b border-amber-900/50">
                <img id="sidebar-pfp"
                     src="{{ user.profile_picture.url }}"
                     alt="Profile Picture"
                     class="w-20 h-20 rounded-full border-2 border-amber-900 object-cover shadow-md" />
                <a href="{% url 'updateprofile' %}"
                   id="edit-pfp-btn"
                   class="mt-3 px-5 py-1.5 bg-amber-900 text-white rounded-xl text-sm hover:bg-amber-800 transition-colors duration-200 inline-block text-center font-medium shadow-sm transform hover:scale-105">Edit
                Profile</a>
            </div>
            <!-- User Info -->
            <div class="flex flex-col p-4 space-y-3 flex-grow text-base">
                <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
                    <strong class="font-semibold text-amber-900">Username:</strong> <span class="text-gray-700">{{ user.username
                    }}</span>
                </div>
                <div class="flex justify-between items-start pb-2 border-b border-amber-900/10">
                    <strong class="font-semibold text-amber-900">Bio:</strong> <span class="text-gray-700 text-right">{{ user.bio|default:'Not set' }}</span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
                    <strong class="font-semibold text-amber-900">Gender:</strong> <span class="text-gray-700">{{ user.gender|default:'Not set' }}</span>
                </div>
                <div class="flex justify-between items-center pb-2 border-b border-amber-900/10">
                    <strong class="font-semibold text-amber-900">Country:</strong> <span class="text-gray-700">{{ user.country|default:'Not set' }}</span>
                </div>
            </div>
            <div class="mt-auto p-4 border-t border-amber-900/50">
                <!-- Logout Button -->
                <form action="{% url 'logout' %}" method="POST">
                    {% csrf_token %}
                    <button type="submit"
                            class="w-full px-4 py-2.5 text-white bg-amber-900 rounded-xl hover:bg-amber-800 transition-colors duration-200 font-bold shadow-md transform hover:scale-105">
                        Logout
                    </button>
                </form>
            </div>
        </div>
        <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pfpBtn = document.getElementById('user-pfp-btn')
      const sidebar = document.getElementById('user-sidebar')
      const menuButton = document.getElementById('menu')
      const mobileMenu = document.getElementById('mobile-menu')
      const backToTop = document.getElementById('backToTop')
      const dsignInButton = document.getElementById('dsignin')
      const msignInButton = document.getElementById('msignin')

      // --- User PFP Sidebar Toggle ---
      pfpBtn?.addEventListener('click', (event) => {
        sidebar.classList.toggle('translate-x-full')
        event.stopPropagation() // Prevent immediate close
      })
      sidebar?.addEventListener('click', (event) => event.stopPropagation())

      // --- Mobile Menu Toggle ---
      menuButton?.addEventListener('click', (event) => {
        event.stopPropagation()
        mobileMenu?.classList.toggle('-translate-x-full')
      })
      mobileMenu?.addEventListener('click', (event) => event.stopPropagation())

      // --- Close menus if clicking outside ---
      document.body.addEventListener('click', (event) => {
        // Close mobile menu
        if (mobileMenu && menuButton && !mobileMenu.contains(event.target) && !menuButton.contains(event.target) && !mobileMenu.classList.contains('-translate-x-full')) {
          mobileMenu.classList.add('-translate-x-full')
        }

        // Close user sidebar
        if (sidebar && !sidebar.contains(event.target) && (!pfpBtn || !pfpBtn.contains(event.target)) && !sidebar.classList.contains('translate-x-full')) {
          sidebar.classList.add('translate-x-full')
        }
      })

      // Swipe gesture for mobile menu
      let touchStartX = 0
      mobileMenu?.addEventListener('touchstart', (event) => (touchStartX = event.touches[0].clientX))
      mobileMenu?.addEventListener('touchmove', (event) => {
        if (!mobileMenu.classList.contains('-translate-x-full')) {
          const touchMoveX = event.touches[0].clientX
          if (touchStartX - touchMoveX > 50) mobileMenu.classList.add('-translate-x-full')
        }
      })

      // --- Sign In Button Redirect ---
      dsignInButton?.addEventListener('click', () => (window.location.href = "{% url 'login' %}"))
      msignInButton?.addEventListener('click', () => (window.location.href = "{% url 'login' %}"))

      // --- Back to top button ---
      window.addEventListener('scroll', () => {
        backToTop?.classList[window.scrollY > 200 ? 'remove' : 'add']('hidden')
      })
      backToTop?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }))

      // --- Toast auto hide ---
      setTimeout(() => {
        const toast = document.getElementById('toast-container')
        if (toast) {
          toast.classList.add('opacity-0', 'translate-y-5', 'scale-95') // Added translate-y and scale for exit animation
          setTimeout(() => toast.remove(), 500)
        }
      }, 3000)
    })
        </script>
    </body>
</html>
