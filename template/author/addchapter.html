{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submit Chapter</title>
    <link href="{% static 'css/output.css' %}" rel="stylesheet" />
</head>

<body class="bg-orange-50 flex items-center justify-center min-h-screen font-sans p-4 md:p-6">
    <div class="bg-white shadow-xl rounded-2xl p-6 sm:p-10 w-full max-w-4xl border border-orange-100 relative">

        <!-- Exit Button -->
        <button onclick="closeForm()" 
                class="absolute top-4 right-4 text-gray-600 hover:text-black text-xl font-bold">âœ•</button>

        <h1 class="text-3xl font-extrabold text-center text-amber-900 mb-8">Submit Chapter</h1>

        <form method="POST" id="chapter-form">
            {% csrf_token %}

            <!-- Chapter Title -->
            <div class="mb-6">
                <label class="block text-amber-800 font-semibold mb-2" for="chapter-title">Chapter Title <span
                        class="text-sm text-gray-500 font-normal">(max 100 characters)</span></label>
                <input type="text" name="title" id="chapter-title-input" maxlength="100"
                    placeholder="Enter chapter title"
                    value="{{ chapter.title|default:'' }}"
                    class="w-full px-4 py-2.5 border border-orange-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition" />
                <p id="char-count" class="text-xs text-gray-600 mt-1 text-right">0 / 100 characters</p>
            </div>

            <!-- Chapter Content Editor -->
            <div class="mb-6 relative">
                <label class="block text-amber-800 font-semibold mb-2" for="chapter-content">Chapter Content</label>
                <div class="border border-orange-200 rounded-lg overflow-hidden relative">
                    <!-- Toolbar -->
                    <div class="flex flex-wrap items-center gap-2 p-3 border-b border-orange-200 bg-orange-100">
                        <button type="button" onclick="toggleFormat(this, 'bold')"
                            class="toolbar-button px-3 py-1.5 text-sm font-medium rounded-md text-amber-900 bg-white hover:bg-amber-100 border border-orange-200">B</button>
                        <button type="button" onclick="toggleFormat(this, 'italic')"
                            class="toolbar-button px-3 py-1.5 text-sm font-medium rounded-md text-amber-900 bg-white hover:bg-amber-100 border border-orange-200">I</button>
                        <button type="button" onclick="toggleFormat(this, 'underline')"
                            class="toolbar-button px-3 py-1.5 text-sm font-medium rounded-md text-amber-900 bg-white hover:bg-amber-100 border border-orange-200">U</button>

                        <select onchange="setFont(this.value)"
                            class="px-3 py-1.5 text-sm border border-orange-200 rounded-md bg-white text-amber-900 w-full sm:w-auto">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Courier New">Courier New</option>
                        </select>

                        <p id="word-count" class="text-xs text-gray-600 sm:ml-auto mt-2 sm:mt-0">0 words</p>
                    </div>

                    <!-- Editable Area -->
                    <div id="chapter-content-editor" contenteditable="true"
                        data-placeholder="Start writing your chapter here..."
                        class="p-4 min-h-[350px] sm:min-h-[450px] w-full overflow-y-auto text-gray-800"
                        style="font-family: Arial;">{{ chapter.content|safe }}</div>
                </div>
            </div>

            <!-- Submit -->
            <button type="submit"
                class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3.5 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-amber-500 mt-4">Submit
                Chapter</button>
        </form>
    </div>

    <script>
        const titleInput = document.getElementById('chapter-title-input')
        const charCount = document.getElementById('char-count')
        const editor = document.getElementById('chapter-content-editor')
        const wordCount = document.getElementById('word-count')

        // Initialize counts
        charCount.textContent = `${titleInput.value.length} / 100 characters`
        wordCount.textContent = `${editor.innerText.trim().split(/\s+/).filter(Boolean).length} words`

        // Count title characters
        titleInput.addEventListener('input', () => {
            charCount.textContent = `${titleInput.value.length} / 100 characters`
        })

        // Count words in editor
        editor.addEventListener('input', () => {
            wordCount.textContent = `${editor.innerText.trim().split(/\s+/).filter(Boolean).length} words`
        })

        // Format toolbar
        function toggleFormat(button, command) {
            editor.focus();
            document.execCommand(command, false, null);

            button.classList.toggle('bg-amber-600');
            button.classList.toggle('text-white');
            button.classList.toggle('text-amber-900');
            button.classList.toggle('bg-white');
            button.classList.toggle('hover:bg-amber-100');
        }

        function setFont(font) {
            document.execCommand('fontName', false, font)
        }

        // Close form
        function closeForm() {
            window.history.back(); // or you can redirect to a dashboard
        }

        // On submit: copy editor HTML to hidden input
        document.getElementById('chapter-form').addEventListener('submit', function (e) {
            let hiddenInput = document.querySelector('input[name="content"]')
            if (!hiddenInput) {
                hiddenInput = document.createElement('input')
                hiddenInput.type = 'hidden'
                hiddenInput.name = 'content'
                this.appendChild(hiddenInput)
            }
            hiddenInput.value = editor.innerHTML.trim()
        })
    </script>
</body>

</html>
